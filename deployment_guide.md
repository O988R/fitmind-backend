# دليل نشر تطبيق FitMind

هذا الدليل يشرح خطوات نشر تطبيق FitMind في بيئة الإنتاج، ويغطي نشر الواجهة الأمامية (Frontend) والخلفية (Backend) وقاعدة البيانات على مختلف منصات الاستضافة.

## جدول المحتويات

1. [متطلبات ما قبل النشر](#متطلبات-ما-قبل-النشر)
2. [نشر الواجهة الأمامية (Frontend)](#نشر-الواجهة-الأمامية-frontend)
   - [النشر على Vercel](#النشر-على-vercel)
   - [النشر على Netlify](#النشر-على-netlify)
3. [نشر الخلفية (Backend) وقاعدة البيانات](#نشر-الخلفية-backend-وقاعدة-البيانات)
   - [النشر على Render](#النشر-على-render)
   - [النشر على Railway](#النشر-على-railway)
   - [النشر على DigitalOcean](#النشر-على-digitalocean)
4. [ربط الواجهة الأمامية بالخلفية](#ربط-الواجهة-الأمامية-بالخلفية)
5. [إعداد النطاق المخصص (Custom Domain)](#إعداد-النطاق-المخصص-custom-domain)
6. [مراقبة الأداء بعد النشر](#مراقبة-الأداء-بعد-النشر)

## متطلبات ما قبل النشر

قبل البدء في عملية النشر، تأكد من توفر المتطلبات التالية:

1. **حسابات على منصات الاستضافة**:
   - حساب على Vercel أو Netlify للواجهة الأمامية
   - حساب على Render أو Railway أو DigitalOcean للخلفية وقاعدة البيانات

2. **ملفات المشروع**:
   - مستودع Git يحتوي على كود المشروع
   - ملف `.env.example` مع جميع المتغيرات المطلوبة
   - ملف `package.json` محدث مع جميع التبعيات والسكريبتات

3. **نطاق مخصص (اختياري)**:
   - نطاق مسجل (مثل fitmind.com)
   - إمكانية الوصول إلى إعدادات DNS للنطاق

## نشر الواجهة الأمامية (Frontend)

### النشر على Vercel

Vercel هي منصة مثالية لنشر تطبيقات الواجهة الأمامية، خاصة تلك المبنية باستخدام React أو Vue أو Angular.

#### الخطوات:

1. **إنشاء حساب على Vercel**:
   - قم بزيارة [vercel.com](https://vercel.com) وسجل حساباً جديداً أو قم بتسجيل الدخول
   - يمكنك التسجيل باستخدام حساب GitHub أو GitLab أو Bitbucket

2. **ربط مستودع Git**:
   - انقر على "Import Project"
   - اختر "Import Git Repository"
   - اختر المستودع الذي يحتوي على كود الواجهة الأمامية لتطبيق FitMind

3. **تكوين المشروع**:
   - حدد مجلد الواجهة الأمامية (مثلاً `src/public`)
   - حدد إطار العمل (Framework) المستخدم (في حالتنا "Static Site")
   - قم بتعيين أمر البناء (Build Command) إذا كان مختلفاً عن الافتراضي

4. **إعداد متغيرات البيئة**:
   - انتقل إلى تبويب "Environment Variables"
   - أضف متغير `REACT_APP_API_URL` (أو ما يعادله) وعيّن قيمته إلى عنوان URL للخلفية
   - أضف متغير `REACT_APP_STRIPE_PUBLISHABLE_KEY` وعيّن قيمته إلى مفتاح Stripe العام

5. **النشر**:
   - انقر على "Deploy"
   - انتظر حتى اكتمال عملية البناء والنشر
   - بعد النشر، ستحصل على عنوان URL للموقع (مثلاً `fitmind.vercel.app`)

6. **تكوين النشر التلقائي (اختياري)**:
   - افتراضياً، سيتم إعادة نشر الموقع تلقائياً عند دفع تغييرات جديدة إلى الفرع الرئيسي
   - يمكنك تعديل هذا السلوك من إعدادات المشروع

### النشر على Netlify

Netlify هي منصة قوية أخرى لنشر تطبيقات الواجهة الأمامية، وتوفر ميزات مشابهة لـ Vercel.

#### الخطوات:

1. **إنشاء حساب على Netlify**:
   - قم بزيارة [netlify.com](https://netlify.com) وسجل حساباً جديداً أو قم بتسجيل الدخول
   - يمكنك التسجيل باستخدام حساب GitHub أو GitLab أو Bitbucket

2. **ربط مستودع Git**:
   - انقر على "New site from Git"
   - اختر مزود Git الخاص بك (GitHub، GitLab، أو Bitbucket)
   - اختر المستودع الذي يحتوي على كود الواجهة الأمامية لتطبيق FitMind

3. **تكوين المشروع**:
   - حدد مجلد البناء (مثلاً `src/public`)
   - حدد أمر البناء إذا كان مختلفاً عن الافتراضي
   - حدد مجلد النشر (مثلاً `src/public`)

4. **إعداد متغيرات البيئة**:
   - انتقل إلى "Site settings" > "Build & deploy" > "Environment"
   - أضف متغيرات البيئة المطلوبة (مشابهة لتلك المذكورة في قسم Vercel)

5. **النشر**:
   - انقر على "Deploy site"
   - انتظر حتى اكتمال عملية البناء والنشر
   - بعد النشر، ستحصل على عنوان URL للموقع (مثلاً `fitmind.netlify.app`)

6. **إعداد إعادة التوجيه (اختياري)**:
   - إذا كنت تستخدم توجيه على جانب العميل (مثل React Router)، قم بإنشاء ملف `_redirects` في مجلد النشر بالمحتوى التالي:
     ```
     /* /index.html 200
     ```
   - هذا سيضمن أن جميع المسارات تُعالج بواسطة تطبيق الواجهة الأمامية

## نشر الخلفية (Backend) وقاعدة البيانات

### النشر على Render

Render هي منصة سحابية حديثة توفر استضافة للتطبيقات والخدمات وقواعد البيانات.

#### نشر قاعدة البيانات PostgreSQL:

1. **إنشاء قاعدة بيانات PostgreSQL**:
   - قم بتسجيل الدخول إلى [dashboard.render.com](https://dashboard.render.com)
   - انقر على "New" > "PostgreSQL"
   - أدخل اسماً لقاعدة البيانات (مثلاً `fitmind-db`)
   - اختر الخطة المناسبة (يُنصح بخطة مدفوعة للإنتاج)
   - انقر على "Create Database"

2. **الحصول على معلومات الاتصال**:
   - بعد إنشاء قاعدة البيانات، ستجد معلومات الاتصال في صفحة التفاصيل
   - احفظ `Internal Database URL` لاستخدامه في إعدادات الخلفية

#### نشر خدمة الخلفية:

1. **إنشاء خدمة ويب**:
   - انقر على "New" > "Web Service"
   - اختر مستودع Git الذي يحتوي على كود الخلفية
   - حدد الفرع الذي تريد نشره

2. **تكوين الخدمة**:
   - أدخل اسماً للخدمة (مثلاً `fitmind-api`)
   - حدد بيئة التشغيل (Node.js)
   - أدخل أمر البناء (مثلاً `npm install`)
   - أدخل أمر البدء (مثلاً `node src/server.js`)
   - حدد الخطة المناسبة

3. **إعداد متغيرات البيئة**:
   - انتقل إلى قسم "Environment Variables"
   - أضف جميع المتغيرات المطلوبة من ملف `.env.example`
   - تأكد من تعيين `DATABASE_URL` إلى قيمة `Internal Database URL` من قاعدة البيانات
   - تأكد من تعيين `NODE_ENV` إلى `production`

4. **النشر**:
   - انقر على "Create Web Service"
   - انتظر حتى اكتمال عملية البناء والنشر
   - بعد النشر، ستحصل على عنوان URL للخدمة (مثلاً `fitmind-api.onrender.com`)

### النشر على Railway

Railway هي منصة سحابية تسمح بنشر التطبيقات وقواعد البيانات بسهولة.

#### الخطوات:

1. **إنشاء حساب على Railway**:
   - قم بزيارة [railway.app](https://railway.app) وسجل حساباً جديداً
   - يمكنك التسجيل باستخدام حساب GitHub

2. **إنشاء مشروع جديد**:
   - انقر على "New Project"
   - اختر "Deploy from GitHub repo"
   - اختر المستودع الذي يحتوي على كود الخلفية

3. **إضافة قاعدة بيانات PostgreSQL**:
   - في لوحة المشروع، انقر على "New"
   - اختر "Database" > "PostgreSQL"
   - انتظر حتى يتم إنشاء قاعدة البيانات

4. **تكوين الخدمة**:
   - انقر على خدمة التطبيق في لوحة المشروع
   - انتقل إلى تبويب "Settings"
   - في قسم "Build & Deploy"، أدخل أمر البدء (مثلاً `node src/server.js`)

5. **إعداد متغيرات البيئة**:
   - انتقل إلى تبويب "Variables"
   - أضف جميع المتغيرات المطلوبة من ملف `.env.example`
   - لاحظ أن Railway يضيف تلقائياً متغيرات الاتصال بقاعدة البيانات

6. **النشر**:
   - Railway ينشر التطبيق تلقائياً عند تكوينه
   - يمكنك إعادة النشر يدوياً بالنقر على "Deploy"
   - بعد النشر، ستجد عنوان URL للخدمة في تبويب "Settings"

### النشر على DigitalOcean

DigitalOcean هي منصة سحابية توفر خوادم افتراضية (Droplets) وخدمات أخرى. هذا الخيار أكثر مرونة ولكنه يتطلب معرفة أكبر بإدارة الخوادم.

#### نشر باستخدام DigitalOcean App Platform:

1. **إنشاء حساب على DigitalOcean**:
   - قم بزيارة [digitalocean.com](https://digitalocean.com) وسجل حساباً جديداً

2. **إنشاء تطبيق جديد**:
   - انتقل إلى "Apps" في لوحة التحكم
   - انقر على "Create App"
   - اختر مصدر التطبيق (GitHub أو GitLab)
   - اختر المستودع الذي يحتوي على كود الخلفية

3. **تكوين التطبيق**:
   - حدد الفرع الذي تريد نشره
   - حدد نوع المكون (Component) كـ "Web Service"
   - حدد بيئة التشغيل (Node.js)
   - أدخل أمر البناء (مثلاً `npm install`)
   - أدخل أمر البدء (مثلاً `node src/server.js`)

4. **إضافة قاعدة بيانات**:
   - في صفحة تكوين التطبيق، انقر على "Add Resource"
   - اختر "Database"
   - اختر "PostgreSQL"
   - حدد الخطة المناسبة

5. **إعداد متغيرات البيئة**:
   - في صفحة تكوين التطبيق، انقر على "Environment Variables"
   - أضف جميع المتغيرات المطلوبة من ملف `.env.example`
   - لاحظ أن DigitalOcean يضيف تلقائياً متغيرات الاتصال بقاعدة البيانات

6. **النشر**:
   - انقر على "Next" حتى تصل إلى صفحة المراجعة النهائية
   - انقر على "Create Resources"
   - انتظر حتى اكتمال عملية النشر
   - بعد النشر، ستجد عنوان URL للتطبيق في صفحة التفاصيل

#### نشر باستخدام Droplet (للمستخدمين المتقدمين):

1. **إنشاء Droplet**:
   - انتقل إلى "Droplets" في لوحة التحكم
   - انقر على "Create Droplet"
   - اختر توزيعة Ubuntu
   - اختر الخطة المناسبة
   - اختر منطقة قريبة من مستخدميك
   - أضف مفتاح SSH أو اختر كلمة مرور
   - انقر على "Create Droplet"

2. **إعداد الخادم**:
   - اتصل بالخادم باستخدام SSH
   - قم بتثبيت Node.js وnpm:
     ```bash
     curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
     sudo apt-get install -y nodejs
     ```
   - قم بتثبيت PostgreSQL:
     ```bash
     sudo apt-get install postgresql postgresql-contrib
     ```

3. **إعداد قاعدة البيانات**:
   - قم بتبديل المستخدم إلى postgres:
     ```bash
     sudo -i -u postgres
     ```
   - أنشئ قاعدة بيانات ومستخدم:
     ```sql
     createdb fitmind
     createuser fitmind_user
     psql
     ALTER USER fitmind_user WITH ENCRYPTED PASSWORD 'your_password';
     GRANT ALL PRIVILEGES ON DATABASE fitmind TO fitmind_user;
     \q
     exit
     ```

4. **نشر التطبيق**:
   - انسخ كود التطبيق إلى الخادم (باستخدام Git أو SCP)
   - انتقل إلى مجلد التطبيق
   - قم بتثبيت التبعيات:
     ```bash
     npm install
     ```
   - أنشئ ملف `.env` وأضف جميع المتغيرات المطلوبة
   - قم بتشغيل التطبيق:
     ```bash
     node src/server.js
     ```

5. **إعداد PM2 لإدارة العمليات**:
   - قم بتثبيت PM2:
     ```bash
     sudo npm install -g pm2
     ```
   - قم بتشغيل التطبيق باستخدام PM2:
     ```bash
     pm2 start src/server.js --name fitmind-api
     ```
   - قم بتكوين PM2 للبدء تلقائياً عند إعادة تشغيل الخادم:
     ```bash
     pm2 startup
     pm2 save
     ```

6. **إعداد Nginx كبروكسي عكسي**:
   - قم بتثبيت Nginx:
     ```bash
     sudo apt-get install nginx
     ```
   - أنشئ ملف تكوين للتطبيق:
     ```bash
     sudo nano /etc/nginx/sites-available/fitmind
     ```
   - أضف التكوين التالي:
     ```nginx
     server {
         listen 80;
         server_name your_domain.com;

         location / {
             proxy_pass http://localhost:3000;
             proxy_http_version 1.1;
             proxy_set_header Upgrade $http_upgrade;
             proxy_set_header Connection 'upgrade';
             proxy_set_header Host $host;
             proxy_cache_bypass $http_upgrade;
         }
     }
     ```
   - قم بتفعيل التكوين:
     ```bash
     sudo ln -s /etc/nginx/sites-available/fitmind /etc/nginx/sites-enabled/
     sudo nginx -t
     sudo systemctl restart nginx
     ```

7. **إعداد SSL باستخدام Let's Encrypt**:
   - قم بتثبيت Certbot:
     ```bash
     sudo apt-get install certbot python3-certbot-nginx
     ```
   - قم بالحصول على شهادة SSL:
     ```bash
     sudo certbot --nginx -d your_domain.com
     ```
   - اتبع التعليمات لإكمال الإعداد

## ربط الواجهة الأمامية بالخلفية

بعد نشر الواجهة الأمامية والخلفية، يجب ربطهما معاً:

1. **تحديث متغيرات البيئة في الواجهة الأمامية**:
   - انتقل إلى إعدادات مشروع الواجهة الأمامية في Vercel أو Netlify
   - قم بتحديث متغير `REACT_APP_API_URL` (أو ما يعادله) ليشير إلى عنوان URL للخلفية

2. **تكوين CORS في الخلفية**:
   - تأكد من أن متغير `CORS_ALLOWED_ORIGINS` في الخلفية يتضمن عنوان URL للواجهة الأمامية
   - أعد نشر الخلفية إذا قمت بتغيير الإعدادات

## إعداد النطاق المخصص (Custom Domain)

لإضافة احترافية أكبر، يمكنك استخدام نطاق مخصص:

### إعداد النطاق المخصص في Vercel:

1. انتقل إلى إعدادات المشروع > "Domains"
2. أدخل النطاق الذي تريد استخدامه (مثلاً `app.fitmind.com`)
3. اتبع التعليمات لإضافة سجلات DNS المطلوبة

### إعداد النطاق المخصص في Netlify:

1. انتقل إلى إعدادات الموقع > "Domain management" > "Domains"
2. انقر على "Add custom domain"
3. أدخل النطاق الذي تريد استخدامه
4. اتبع التعليمات لإضافة سجلات DNS المطلوبة

### إعداد النطاق المخصص في Render/Railway/DigitalOcean:

1. انتقل إلى إعدادات الخدمة أو التطبيق
2. ابحث عن قسم "Custom Domain" أو ما يعادله
3. أدخل النطاق الذي تريد استخدامه (مثلاً `api.fitmind.com`)
4. اتبع التعليمات لإضافة سجلات DNS المطلوبة

## مراقبة الأداء بعد النشر

بعد نشر التطبيق، من المهم مراقبة أدائه:

1. **مراقبة الخطأ**:
   - قم بتكوين Sentry أو خدمة مماثلة لتتبع الأخطاء
   - راجع سجلات الخطأ بانتظام

2. **مراقبة الأداء**:
   - استخدم أدوات مثل New Relic أو Datadog لمراقبة أداء التطبيق
   - راقب استخدام الموارد (CPU، الذاكرة، قاعدة البيانات)

3. **مراقبة توفر الخدمة**:
   - استخدم أدوات مثل Uptime Robot لمراقبة توفر التطبيق
   - قم بإعداد تنبيهات للانقطاعات

4. **النسخ الاحتياطي**:
   - تأكد من إعداد نسخ احتياطية منتظمة لقاعدة البيانات
   - اختبر استعادة النسخ الاحتياطية بشكل دوري

---

هذا الدليل يغطي الخطوات الأساسية لنشر تطبيق FitMind في بيئة الإنتاج. قد تختلف بعض التفاصيل اعتماداً على الإصدارات الحالية للمنصات والخدمات المذكورة. راجع دائماً الوثائق الرسمية للحصول على أحدث المعلومات.
